{
   "$schema":"http://json-schema.org/draft-07/schema#",
   "$id":"https://github.com/metameta-protocol/metametasets-schema/src/set.smartcontract.schema.json",
   "title":"Web3 Meta Set Fragment Schema",
   "description":"A Meta Entity set fragment schema for Web3 Set Theory protocol.",
   "type":"object",
   "additionalProperties":true,
   "required":[
      "id",
      "name",
      "object",
      "createdAt",
      "version",
      "entities",
      "rules"
   ],
   "properties":{
      "id":{
         "$ref":"#/definitions/IdentifierDefinition"
      },
      "name":{
         "$ref":"#/definitions/NameDefinition"
      },
      "object":{
         "$ref":"#/definitions/ObjectDefinition"
      },
      "createdAt":{
         "type":"string",
         "format":"date-time",
         "description":"The timestamp of when the set was created"
      },
      "updatedAt":{
         "type":"string",
         "format":"date-time",
         "description":"The timestamp of when the set was created"
      },
      "version":{
         "$ref":"#/definitions/Version"
      },
      "entities":{
         "type":"array",
         "description":"The list of entities included in the set.",
         "items":{
            "type":"string",
            "description":"A URI to a valid content object",
            "format":"uri",
            "examples":[
               "ipfs://"
            ]
         },
         "minItems":0,
         "maxItems":100
      },
      "conditions":{
         "type":"array",
         "description":"Conditions that apply to the set entities.",
         "items":{
            "$ref":"#/definitions/ConditionDefinition"
         },
         "minItems":0,
         "maxItems":10000
      },
      "rules":{
         "type":"array",
         "description":"Rules that apply to the set conditions.",
         "items":{
            "$ref":"#/definitions/RuleDefinition"
         },
         "minItems":0,
         "maxItems":10000
      },
      "keywords":{
         "type":"array",
         "description":"Keywords associated with the contents of the list; may be used in list discoverability",
         "items":{
            "type":"string",
            "description":"A keyword to describe the contents of the list",
            "minLength":1,
            "maxLength":20,
            "pattern":"^[\\w ]+$",
            "examples":[
               "defi",
               "swap",
               "deposit"
            ]
         },
         "maxItems":20,
         "uniqueItems":true
      },
      "tags":{
         "type":"object",
         "description":"A mapping of tag identifiers to their name and description",
         "propertyNames":{
            "$ref":"#/definitions/TagIdentifier"
         },
         "additionalProperties":{
            "$ref":"#/definitions/TagDefinition"
         },
         "maxProperties":20,
         "examples":[
            {
               "savings":{
                  "name":"Savings",
                  "description":"Smart contract with savings features"
               }
            }
         ]
      },
      "contentUri":{
         "type":"string",
         "description":"A URI to a valid content object",
         "format":"uri",
         "examples":[
            "ipfs://"
         ]
      }
   },
   "definitions":{
      "IdentifierDefinition":{
         "type":"string",
         "description":"Identifier",
         "minLength":1,
         "maxLength":256,
         "examples":[
            "contract-uniswap-v3-swapRouter"
         ]
      },
      "ObjectDefinition":{
         "type":"string",
         "description":"Object identifier",
         "minLength":1,
         "maxLength":256,
         "examples":[
            "set.meta",
            "rule.smartcontract",
            "condition.did"
         ]
      },
      "NameDefinition":{
         "type":"string",
         "description":"Name (Generic)",
         "minLength":1,
         "maxLength":256,
         "examples":[
            "Uniswap.exactInputSingle: Swap for 100 USDC (Minimum)"
         ]
      },
      "ConditionDefinition":{
         "type":"object",
         "description":"",
         "additionalProperties":false,
         "required":[
            "id",
            "entityIds",
            "type",
            "range",
            "function",
            "arguments"
         ],
         "properties":{
            "id":{
               "$ref":"#/definitions/IdentifierDefinition"
            },
            "object":{
               "type":"string",
               "pattern":"^condition.meta$",
               "description":"Object identifier"
            },
            "entityIds":{
               "type":"array",
               "items":{
                  "type":"string",
                  "format":"uri",
                  "examples":[
                     "ipfs://"
                  ]
               },
               "minItems":0,
               "maxItems":100
            },
            "type":{
               "type":"string",
               "oneOf":[
                  {
                     "type":"string",
                     "pattern":"^set.smartcontract$"
                  },
                  {
                     "type":"string",
                     "pattern":"^set.did$"
                  },
                  {
                     "type":"string",
                     "pattern":"^set.meta$"
                  }
               ],
               "examples":[
                  "set.smartcontract",
                  "set.did",
                  "set.meta"
               ]
            },
            "range":{
               "type":"array",
               "items": {
                  "anyOf":[
                     {
                        "type":"string"
                     },
                     {
                        "type":"integer"
                     },
                     {
                        "type":"array"
                     }
                  ]
               },
               "examples":[
                  ["all"],
                  ["any"],
                  ["id-1", "id-2"],
                  [1, 3],
                  [ [ "id-1", "id-2" ], [ "id-3", "id-4" ] ],
                  [ [ 1, 2 ], [ 3, 4 ] ]
               ]
            },
            "function":{
               "type":"array",
               "items": {
                  "anyOf":[
                     {
                        "type":"string",
                        "pattern":"^isComplete$"
                     },
                     {
                        "type":"string",
                        "pattern":"^minimumConfirmations$"
                     },
                     {
                        "type":"string",
                        "pattern":"^beforeTimestamp$"
                     },
                     {
                        "type":"string",
                        "pattern":"^afterTimestamp$"
                     },
                     {
                        "type":"string",
                        "pattern":"^beforeBlock$"
                     },
                     {
                        "type":"string",
                        "pattern":"^afterBlock$"
                     },
                     {
                        "type":"string",
                        "pattern":"^minimumRulesComplete$"
                     },
                     {
                        "type":"string",
                        "pattern":"^percentageComplete$"
                     }
                  ]
               }
            },
            "arguments":{
               "type":"array",
               "items": {
                  "anyOf":[
                     {
                        "type":"array"
                     },
                     {
                        "type":"string"
                     },
                     {
                        "type":"integer"
                     },
                     {
                        "type":"boolean"
                     },
                     {
                        "type":"object"
                     }
                  ]
               }
            }
         }
      },
      "RuleDefinition":{
         "type":"object",
         "additionalProperties":false,
         "required":[
            "id",
            "object",
            "conditionIds",
            "range",
            "function",
            "arguments"
         ],
         "properties":{
            "id":{
               "$ref":"#/definitions/IdentifierDefinition"
            },
            "name":{
               "$ref":"#/definitions/NameDefinition"
            },
            "object":{
               "$ref":"#/definitions/ObjectDefinition"
            },
            "conditionIds":{
               "type":"array",
               "description":"",
               "items":{
                  "$ref":"#/definitions/IdentifierDefinition"
               },
               "maxItems":256,
               "uniqueItems":true
            },
            "range":{
               "type":"array",
               "items": {
                  "anyOf":[
                     {
                        "type":"string"
                     },
                     {
                        "type":"integer"
                     },
                     {
                        "type":"array"
                     }
                  ]
               },
               "examples":[
                  ["all"],
                  ["any"],
                  ["id-1", "id-2"],
                  [1, 3],
                  [ [ "id-1", "id-2" ], [ "id-3", "id-4" ] ],
                  [ [ 1, 2 ], [ 3, 4 ] ]
               ]
            },
            "function":{
               "type":"array",
               "items": {
                  "anyOf":[
                     {
                        "type":"string",
                        "pattern":"^isComplete$"
                     },
                     {
                        "type":"string",
                        "pattern":"^minimumConfirmations$"
                     },
                     {
                        "type":"string",
                        "pattern":"^beforeTimestamp$"
                     },
                     {
                        "type":"string",
                        "pattern":"^afterTimestamp$"
                     },
                     {
                        "type":"string",
                        "pattern":"^beforeBlock$"
                     },
                     {
                        "type":"string",
                        "pattern":"^afterBlock$"
                     },
                     {
                        "type":"string",
                        "pattern":"^minimumRulesComplete$"
                     },
                     {
                        "type":"string",
                        "pattern":"^percentageComplete$"
                     }
                  ]
               }
            },
            "arguments":{
               "type":"array",
               "items": {
                  "anyOf":[
                     {
                        "type":"array"
                     },
                     {
                        "type":"string"
                     },
                     {
                        "type":"integer"
                     },
                     {
                        "type":"boolean"
                     },
                     {
                        "type":"object"
                     }
                  ]
               }
            }
         }
      },
      "TagIdentifier":{
         "type":"string",
         "description":"The unique identifier of a tag",
         "minLength":1,
         "maxLength":10,
         "pattern":"^[\\w]+$",
         "examples":[
            "compound",
            "stablecoin"
         ]
      },
      "TagDefinition":{
         "type":"object",
         "description":"Definition of a tag that can be associated with a token via its identifier",
         "additionalProperties":false,
         "properties":{
            "name":{
               "type":"string",
               "description":"The name of the tag",
               "pattern":"^[ \\w]+$",
               "minLength":1,
               "maxLength":20
            },
            "description":{
               "type":"string",
               "description":"A user-friendly description of the tag",
               "pattern":"^[ \\w\\.,:]+$",
               "minLength":1,
               "maxLength":200
            }
         },
         "required":[
            "name",
            "description"
         ],
         "examples":[
            {
               "name":"Stablecoin",
               "description":"A token with value pegged to another asset"
            }
         ]
      },
      "Version":{
         "type":"object",
         "description":"The version of the set, used in change detection",
         "examples":[
            {
               "major":1,
               "minor":0,
               "patch":0
            }
         ],
         "additionalProperties":false,
         "properties":{
            "major":{
               "type":"integer",
               "description":"The major version of the list. Must be incremented when smart contract are removed from the list or smart contract addresses are changed.",
               "minimum":0,
               "examples":[
                  1,
                  2
               ]
            },
            "minor":{
               "type":"integer",
               "description":"The minor version of the list. Must be incremented when smart contracts are added to the set.",
               "minimum":0,
               "examples":[
                  0,
                  1
               ]
            },
            "patch":{
               "type":"integer",
               "description":"The patch version of the list. Must be incremented for any changes to the list.",
               "minimum":0,
               "examples":[
                  0,
                  1
               ]
            }
         },
         "required":[
            "major",
            "minor",
            "patch"
         ]
      }
   }
 }